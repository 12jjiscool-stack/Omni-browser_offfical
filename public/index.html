<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Omni Browser</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: var(--bg, #f4f4f4);
      color: var(--text, #333);
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      background: #d32f2f;
      color: white;
    }
    .search-container {
      flex-grow: 1;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-left: 20px;
    }
    .search-container select,
    .search-container input {
      padding: 8px;
      border-radius: 6px;
      border: none;
      outline: none;
    }
    .search-container button {
      background: white;
      border: none;
      border-radius: 6px;
      padding: 8px 14px;
      cursor: pointer;
      font-weight: bold;
      color: #d32f2f;
    }
    .dice {
      margin-left: 10px;
      cursor: pointer;
      font-size: 20px;
    }
    .menu-btn, .profile-bubble {
      background: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      cursor: pointer;
      font-weight: bold;
      margin-left: 10px;
    }
    .sidebar {
      position: fixed;
      top: 0;
      left: -260px;
      width: 260px;
      height: 100%;
      background: #222;
      color: white;
      transition: left 0.3s ease;
      padding: 20px;
      z-index: 1000;
    }
    .sidebar.active { left: 0; }
    .sidebar h2 { margin-top: 0; }
    .sidebar button {
      display: block;
      margin: 10px 0;
      padding: 10px;
      width: 100%;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    /* Tabs */
    .tabs {
      display: flex;
      background: #eee;
      border-bottom: 1px solid #ccc;
      overflow-x: auto;
      align-items: center;
    }
    .tab {
      background: #ddd;
      padding: 8px 14px;
      margin-right: 4px;
      border-top-left-radius: 6px;
      border-top-right-radius: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }
    .tab.active { background: white; border-bottom: 2px solid #d32f2f; }
    .tab .close { font-weight: bold; cursor: pointer; }
    .new-tab-btn {
      padding: 8px 14px;
      background: #ddd;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    .tab-content { height: calc(100vh - 200px); }
    .tab-content iframe { width: 100%; height: 100%; border: none; }
    /* Homepage content */
    .homepage {
      padding: 20px;
    }
    .shortcuts {
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    .shortcut {
      display: flex;
      align-items: center;
      gap: 6px;
      background: #fff;
      padding: 8px 14px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      cursor: pointer;
    }
    .shortcut img { width: 20px; height: 20px; }
    #news-feed {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
    }
    .news-card {
      background: #fff;
      padding: 12px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .news-card img {
      width: 100%;
      border-radius: 6px;
      margin-bottom: 8px;
    }
    /* Themes */
    body.light { --bg: #f4f4f4; --text: #333; }
    body.dark { --bg: #121212; --text: #eee; }
    body.night { --bg: #1a1a2e; --text: #cfcfcf; }
  </style>
</head>
<body class="light">
  <header>
    <button class="menu-btn">â˜°</button>
    <div class="search-container">
      <select id="engine">
        <option value="https://www.google.com/search?q=">Google</option>
        <option value="https://duckduckgo.com/?q=">DuckDuckGo</option>
        <option value="https://www.bing.com/search?q=">Bing</option>
      </select>
      <input type="text" id="searchBox" placeholder="Search the web..."/>
      <button onclick="searchWeb()">Search</button>
      <span class="dice" onclick="rollDice()">ðŸŽ²</span>
    </div>
    <button class="profile-bubble" id="profileBubble">?</button>
  </header>

  <div class="tabs" id="tabs"></div>
  <div class="tab-content" id="tabContent"></div>

  <div class="sidebar" id="sidebar">
    <h2>Menu</h2>
    <button onclick="toggleThemeMenu()">Themes</button>
    <div id="themeMenu" style="display:none;">
      <button onclick="setTheme('light')">Light</button>
      <button onclick="setTheme('dark')">Dark</button>
      <button onclick="setTheme('night')">Night</button>
      <button onclick="editBackground()">Edit Background</button>
    </div>
    <button onclick="toggleNews()">Hide News Feed</button>
    <button onclick="signIn()">Sign In</button>
  </div>

  <script>
    const sidebar = document.getElementById('sidebar');
    document.querySelector('.menu-btn').onclick = () => {
      sidebar.classList.toggle('active');
    };

    const tabsDiv = document.getElementById('tabs');
    const tabContent = document.getElementById('tabContent');
    let tabs = [];
    let activeTab = null;

    function createHomepage() {
      const id = Date.now();
      tabs.push({id, title: "New Tab", type: "homepage"});
      setActiveTab(id);
      renderTabs();
    }

    function searchWeb() {
      const engine = document.getElementById('engine').value;
      const query = document.getElementById('searchBox').value;
      if (!query) return;
      const url = engine + encodeURIComponent(query);
      const id = Date.now();
      tabs.push({id, title: query, type: "web", url});
      setActiveTab(id);
      renderTabs();
    }

    function setActiveTab(id) {
      activeTab = id;
      renderTabs();
    }

    function closeTab(id) {
      tabs = tabs.filter(t => t.id !== id);
      if (activeTab === id && tabs.length) {
        activeTab = tabs[tabs.length - 1].id;
      }
      renderTabs();
    }

    function renderTabs() {
      tabsDiv.innerHTML = "";
      tabContent.innerHTML = "";

      tabs.forEach(tab => {
        const t = document.createElement("div");
        t.className = "tab" + (tab.id === activeTab ? " active" : "");
        t.onclick = () => setActiveTab(tab.id);
        t.innerHTML = tab.title + ` <span class="close" onclick="event.stopPropagation(); closeTab(${tab.id})">Ã—</span>`;
        tabsDiv.appendChild(t);
      });

      const newTabBtn = document.createElement("div");
      newTabBtn.className = "new-tab-btn";
      newTabBtn.innerText = "+";
      newTabBtn.onclick = createHomepage;
      tabsDiv.appendChild(newTabBtn);

      const tab = tabs.find(t => t.id === activeTab);
      if (!tab) return;

      if (tab.type === "homepage") {
        const div = document.createElement("div");
        div.className = "homepage";
        div.innerHTML = `
          <div class="shortcuts">
            <div class="shortcut" onclick="openSite('https://mail.google.com')">
              <img src="https://cdn4.iconfinder.com/data/icons/logos-brands-in-colors/48/google-gmail-256.png"/> Gmail
            </div>
            <div class="shortcut" onclick="openSite('https://youtube.com')">
              <img src="https://cdn4.iconfinder.com/data/icons/logos-and-brands/512/395_Youtube_logo-256.png"/> YouTube
            </div>
            <div class="shortcut" onclick="openSite('https://chat.openai.com')">
              <img src="https://cdn3.iconfinder.com/data/icons/social-media-brands-1/128/chat-gpt-256.png"/> ChatGPT
            </div>
            <div class="shortcut" onclick="addShortcut()">+ Add Shortcut</div>
          </div>
          <div id="news-feed"></div>
        `;
        tabContent.appendChild(div);
        loadNews();
      } else if (tab.type === "web") {
        const iframe = document.createElement("iframe");
        iframe.src = tab.url;
        tabContent.appendChild(iframe);
      }
    }

    function openSite(url) {
      const id = Date.now();
      tabs.push({id, title: url, type: "web", url});
      setActiveTab(id);
      renderTabs();
    }

    function rollDice() {
      const sites = ["https://pbskids.org","https://youtube.com","https://coolmathgames.com"];
      const site = sites[Math.floor(Math.random()*sites.length)];
      openSite(site);
    }

    async function loadNews() {
      const res = await fetch("https://api.rss2json.com/v1/api.json?rss_url=https://rss.cnn.com/rss/cnn_topstories.rss");
      const data = await res.json();
      const feed = document.getElementById("news-feed");
      if (!feed) return;
      feed.innerHTML = "";
      data.items.slice(0,6).forEach(item => {
        const card = document.createElement("div");
        card.className = "news-card";
        card.innerHTML = `<img src="${item.enclosure?.link || ''}"/>
                          <h4><a href="${item.link}" target="_blank">${item.title}</a></h4>
                          <p>${item.description}</p>`;
        feed.appendChild(card);
      });
    }
    setInterval(loadNews, 300000);

    function toggleThemeMenu() {
      const menu = document.getElementById('themeMenu');
      menu.style.display = menu.style.display === "none" ? "block" : "none";
    }
    function setTheme(mode) {
      document.body.className = mode;
    }
    function editBackground() {
      const input = document.createElement('input');
      input.type = "file";
      input.accept = "image/*";
      input.onchange = e => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = ev => {
            document.body.style.backgroundImage = `url(${ev.target.result})`;
            document.body.style.backgroundSize = "cover";
          };
          reader.readAsDataURL(file);
        }
      };
      input.click();
    }

    let newsVisible = true;
    function toggleNews() {
      const feed = document.getElementById("news-feed");
      if (!feed) return;
      newsVisible = !newsVisible;
      feed.style.display = newsVisible ? "grid" : "none";
      event.target.innerText = newsVisible ? "Hide News Feed" : "Show News Feed";
    }

    const profileBubble = document.getElementById("profileBubble");
    function signIn() {
      const username = prompt("Enter username:");
      const email = prompt("Enter email:");
      const pass = prompt("Enter password:");
      if(username && email && pass) {
        localStorage.setItem("user", JSON.stringify({username,email,pass}));
        profileBubble.innerText = username[0].toUpperCase();
        profileBubble.onclick = editProfile;
      }
    }
    function editProfile() {
      const user = JSON.parse(localStorage.getItem("user"));
      const username = prompt("Update username:", user.username);
      const email = prompt("Update email:", user.email);
      const pass = prompt("Update password:", user.pass);
      if(username && email && pass) {
        localStorage.setItem("user", JSON.stringify({username,email,pass}));
        profileBubble.innerText = username[0].toUpperCase();
      }
    }
    if(localStorage.getItem("user")) {
      const user = JSON.parse(localStorage.getItem("user"));
      profileBubble.innerText = user.username[0].toUpperCase();
      profileBubble.onclick = editProfile;
    }

    // Load default homepage on startup
    createHomepage();
  </script>
</body>
</html>
