<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Omni Portal</title>
  <link id="favicon" rel="icon" href="https://www.google.com/favicon.ico" />

  <style>
    /* same styles as before, trimmed for brevity */
    html, body { margin:0; padding:0; height:100%; font-family:system-ui,sans-serif; color:#f1f5f9; }
    body { background:linear-gradient(270deg,#0f172a,#1e293b,#0f172a); background-size:600% 600%; animation:gradientShift 30s ease infinite; overflow:hidden; }
    @keyframes gradientShift { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
    .card { position:relative; z-index:1; max-width:500px; margin:8vh auto; background:rgba(30,41,59,.7); padding:2rem; border-radius:1rem; backdrop-filter:blur(10px); text-align:center; box-shadow:0 8px 30px rgba(0,0,0,.4); }
    .time-bar { margin:1rem 0; padding:0.6rem; border-radius:0.5rem; background:rgba(15,23,42,.8); font-weight:bold; }
    .search-container { display:flex; align-items:center; justify-content:center; gap:0.5rem; margin-top:1rem; }
    .search-container input { flex:1; padding:0.6rem 1rem; border-radius:0.5rem; border:1px solid #475569; background:#1e293b; color:white; }
    .search-container button { padding:0.6rem 1rem; border:none; border-radius:0.5rem; background:#3b82f6; color:white; cursor:pointer; }
    .status-box { display:flex; gap:0.5rem; align-items:center; font-size:0.85rem; }
    .badge { background:rgba(59,130,246,.2); padding:4px 8px; border-radius:0.5rem; }
    .bubble { position:fixed; bottom:15px; left:15px; background:rgba(30,41,59,.85); padding:8px 14px; border-radius:20px; font-style:italic; font-size:0.9rem; box-shadow:0 4px 12px rgba(0,0,0,.3); }
    .edit-bg-btn { position:fixed; bottom:15px; right:15px; background:#3b82f6; color:white; border:none; padding:10px 14px; border-radius:0.5rem; cursor:pointer; }
    .edit-bg-panel { display:none; position:fixed; bottom:60px; right:15px; background:rgba(30,41,59,.95); padding:1rem; border-radius:0.5rem; box-shadow:0 6px 20px rgba(0,0,0,.4); }
  </style>
</head>
<body>
  <div class="card">
    <h1>Omni Portal</h1>
    <p id="location">üìç Locating...</p>
    <div class="time-bar" id="timeBar">--:--:--</div>

    <div class="search-container">
      <form id="searchForm" target="_blank" style="flex:1; display:flex; gap:0.5rem;">
        <input id="searchBox" type="text" placeholder="Search with DuckDuckGo..." required />
        <button type="submit">Search</button>
      </form>
      <div class="status-box">
        <div class="badge" id="battery">üîã --%</div>
        <div class="badge" id="temp">üå°Ô∏è --¬∞C</div>
      </div>
    </div>

    <div class="shortcuts" id="shortcuts"></div>
    <form id="shortcutForm">
      <input id="shortcutName" type="text" placeholder="Shortcut Name" required />
      <input id="shortcutUrl" type="text" placeholder="https://example.com" required />
      <button type="submit">Add</button>
    </form>

    <div style="margin-top:1rem;">
      <input id="cloakTitle" type="text" placeholder="Fake Tab Title" />
      <input id="cloakIcon" type="text" placeholder="Favicon URL" />
      <button onclick="cloakTab()">Cloak Tab</button>
    </div>
  </div>

  <div class="bubble">made by Jacob Maddox</div>
  <button class="edit-bg-btn" onclick="toggleBgPanel()">Edit Background</button>
  <div class="edit-bg-panel" id="editBgPanel">
    <input id="bgColor" type="text" placeholder="Color/gradient" />
    <input id="bgImage" type="text" placeholder="Image URL (optional)" />
    <button onclick="applyBackground()">Apply</button>
  </div>

  <script>
    // Time
    function updateTime() {
      document.getElementById("timeBar").textContent = new Date().toLocaleTimeString();
    }
    setInterval(updateTime, 1000); updateTime();

    // Search
    document.getElementById("searchForm").addEventListener("submit", e => {
      e.preventDefault();
      const q = encodeURIComponent(document.getElementById("searchBox").value.trim());
      if (q) window.open(`https://duckduckgo.com/?q=${q}`, "_blank");
    });

    // Cloak
    function cloakTab() {
      const t = document.getElementById("cloakTitle").value.trim();
      const i = document.getElementById("cloakIcon").value.trim();
      if (t) document.title = t;
      if (i) document.getElementById("favicon").href = i;
    }

    // Shortcuts
    const shortcutsEl = document.getElementById("shortcuts");
    const shortcutForm = document.getElementById("shortcutForm");
    function loadShortcuts() {
      shortcutsEl.innerHTML = "";
      (JSON.parse(localStorage.getItem("shortcuts") || "[]")).forEach(sc => {
        const a = document.createElement("a");
        a.href = sc.url; a.target="_blank"; a.className="shortcut"; a.textContent=sc.name;
        shortcutsEl.appendChild(a);
      });
    }
    shortcutForm.addEventListener("submit", e => {
      e.preventDefault();
      const nm = document.getElementById("shortcutName").value.trim();
      const url = document.getElementById("shortcutUrl").value.trim();
      if (nm && url) {
        const arr = JSON.parse(localStorage.getItem("shortcuts") || "[]");
        arr.push({ name:nm, url });
        localStorage.setItem("shortcuts", JSON.stringify(arr));
        loadShortcuts(); shortcutForm.reset();
      }
    });
    loadShortcuts();

    // Battery
    if (navigator.getBattery) {
      navigator.getBattery().then(b => {
        function upd(){ document.getElementById("battery").textContent="üîã "+Math.round(b.level*100)+"%"; }
        upd(); b.addEventListener("levelchange",upd);
      });
    }

    // Weather + Reverse Geocoding
    async function fetchWeather(lat, lon) {
      const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
      const data = await res.json();
      if (data.current_weather && data.current_weather.temperature) {
        document.getElementById("temp").textContent = `üå°Ô∏è ${data.current_weather.temperature.toFixed(1)}¬∞C`;
      }
    }
    async function fetchLocation(lat, lon) {
      const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
      const data = await res.json();
      if (data && data.address) {
        const city = data.address.city || data.address.town || data.address.village || "";
        const state = data.address.state || "";
        document.getElementById("location").textContent = `üìç ${city}, ${state}`;
      }
    }
    function initWeatherAndLocation() {
      if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(pos => {
          const { latitude, longitude } = pos.coords;
          fetchWeather(latitude, longitude);
          fetchLocation(latitude, longitude);
        }, () => {
          // fallback NYC
          fetchWeather(40.7128, -74.0060);
          fetchLocation(40.7128, -74.0060);
        });
      } else {
        fetchWeather(40.7128, -74.0060);
        fetchLocation(40.7128, -74.0060);
      }
    }
    initWeatherAndLocation();

    // Background editor
    const editPanel=document.getElementById("editBgPanel");
    function toggleBgPanel(){ editPanel.style.display=editPanel.style.display==="block"?"none":"block"; }
    function applyBackground(){
      const c=document.getElementById("bgColor").value.trim();
      const i=document.getElementById("bgImage").value.trim();
      let style="";
      if(i){ style=`url(${i}) center/cover no-repeat`; }
      else if(c){ style=c; }
      if(style){ document.body.style.background=style; localStorage.setItem("customBg",style); }
    }
    const saved=localStorage.getItem("customBg");
    if(saved) document.body.style.background=saved;
  </script>
</body>
</html>

