<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Omni Portal</title>

  <!-- Custom Omni Favicon (inline) -->
  <link id="favicon" rel="icon" type="image/png"
    href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiI+PHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iNiIgZmlsbD0iI2VhNDMzNSIvPjx0ZXh0IHg9IjE2IiB5PSIyMCIgZm9udC1zaXplPSIxMCIgZm9udC1mYW1pbHk9InN5c3RlbS11aSIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGwiPk9tbmk8L3RleHQ+PC9zdmc+" />

  <style>
    html, body { margin:0; padding:0; height:100%; font-family:system-ui, sans-serif; color:#f1f5f9; background:linear-gradient(270deg,#0f172a,#1e293b,#0f172a); background-size:600% 600%; animation:gradientShift 30s ease infinite;}
    @keyframes gradientShift {0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    .stars{ position:fixed; inset:0; z-index:-1; }
    .star{ position:absolute; background:white; border-radius:50%; opacity:0.8; animation:twinkle 6s infinite ease-in-out; }
    @keyframes twinkle{0%,100%{opacity:0.2}50%{opacity:1}}

    .card{ max-width:760px; margin:3rem auto; background:rgba(15,23,42,0.85); padding:1.6rem; border-radius:12px; box-shadow:0 12px 40px rgba(0,0,0,0.45); }
    h1{ margin:0 0 6px 0; font-size:1.35rem; }
    #location{ color:#cbd5e1; margin-bottom:8px; }

    .time-bar{ font-weight:600; margin-bottom:12px; }

    .search-row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-bottom:10px; }
    .gmail-btn{ background:#ea4335; color:white; border:none; padding:10px 14px; border-radius:8px; font-weight:700; cursor:pointer; }
    .search-input{ flex:1 1 360px; padding:10px 14px; border-radius:8px; border:none; background:#0f1724; color:white; }
    .search-btn{ background:#2563eb; color:white; padding:10px 14px; border:none; border-radius:8px; cursor:pointer; font-weight:700; }
    .status{ display:flex; gap:12px; align-items:center; color:#cbd5e1; margin-left:6px; }

    .ai-section{ margin:12px 0; }
    .ai-toggle{ display:block; width:100%; background:#7e22ce; color:white; padding:12px; border:none; border-radius:10px; font-weight:700; cursor:pointer; text-align:center; }
    .ai-container{ margin-top:8px; background:rgba(34,41,55,0.7); padding:12px; border-radius:10px; display:none; }
    .ai-container textarea{ width:100%; min-height:80px; padding:8px; border-radius:8px; border:none; background:#0f1724; color:white; resize:vertical; }
    .ai-container .ask-btn{ margin-top:8px; background:#2563eb; color:white; padding:8px 12px; border:none; border-radius:8px; cursor:pointer; }
    .ai-response{ margin-top:10px; background:#0b1220; padding:10px; border-radius:8px; color:#e6eef8; min-height:40px; white-space:pre-wrap; }

    .shortcuts{ display:flex; flex-wrap:wrap; gap:8px; margin:10px 0; }
    .shortcut{ background:#334155; padding:8px 12px; border-radius:999px; color:white; text-decoration:none; font-weight:600; }
    .shortcut-form{ display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px; }
    .shortcut-form input{ padding:8px; border-radius:8px; border:none; background:#0f1724; color:white; }

    .cloak-section{ margin-top:10px; background:rgba(0,0,0,0.05); padding:10px; border-radius:8px; }
    .cloak-form{ display:flex; gap:8px; flex-wrap:wrap; }
    .cloak-form input{ padding:8px; border-radius:8px; border:none; background:#0f1724; color:white; }
    .cloak-form button{ background:#6b21a8; color:white; padding:8px 12px; border:none; border-radius:8px; cursor:pointer; }

    .bubble{ position:fixed; bottom:10px; left:10px; background:rgba(0,0,0,0.6); padding:8px 12px; border-radius:999px; font-style:italic; font-size:0.85rem; }
    .edit-bg{ position:fixed; bottom:10px; right:10px; background:#475569; padding:8px 12px; border-radius:8px; cursor:pointer; color:white; }

    /* small screens */
    @media (max-width:520px){
      .card{ margin:1.6rem 10px; padding:12px; }
    }
  </style>
</head>
<body>
  <div class="stars" id="stars"></div>

  <div class="card" role="main">
    <h1>Omni</h1>
    <div id="location">üìç Detecting location...</div>

    <div class="time-bar" id="timeBar">--:--:--</div>

    <div class="search-row">
      <button class="gmail-btn" onclick="openGmail()">üìß Gmail</button>
      <input id="searchBox" class="search-input" type="text" placeholder="Search with DuckDuckGo..." />
      <button class="search-btn" onclick="searchQuery()">Search</button>
      <div class="status">
        <div id="battery">üîã --%</div>
        <div id="temperature">üå°Ô∏è --¬∞C</div>
      </div>
    </div>

    <!-- AI Assistant -->
    <div class="ai-section">
      <button class="ai-toggle" id="aiToggle">ü§ñ Open AI Assistant</button>
      <div class="ai-container" id="aiContainer" aria-hidden="true">
        <textarea id="aiInput" placeholder="Ask me anything..."></textarea>
        <div style="display:flex; gap:8px; align-items:center; margin-top:8px;">
          <button class="ask-btn" onclick="askAI()">Ask</button>
          <button onclick="clearAI()">Clear</button>
        </div>
        <div class="ai-response" id="aiResponse">üí¨ Response will appear here...</div>
      </div>
    </div>

    <!-- Shortcuts -->
    <div class="shortcuts" id="shortcuts"></div>
    <form id="shortcutForm" class="shortcut-form" onsubmit="return addShortcut(event);">
      <input id="shortcutName" placeholder="Name" required />
      <input id="shortcutUrl" placeholder="https://example.com" required />
      <button type="submit">Ôºã Add</button>
    </form>

    <!-- Cloak -->
    <div class="cloak-section">
      <h3 style="margin:0 0 8px 0; color:#cbd5e1;">üï∂Ô∏è Tab Cloaker</h3>
      <div class="cloak-form">
        <input id="cloakTitle" placeholder="Fake Tab Title" />
        <input id="cloakIcon" placeholder="Favicon URL" />
        <button onclick="cloakTab()">Apply</button>
      </div>
    </div>
  </div>

  <div class="bubble">made by Jacob Maddox</div>
  <div class="edit-bg" onclick="editBackground()">üé® Edit Background</div>

  <script>
    /* ---------- IMPORTANT (UNSAFE) ----------
       This file contains your API key in client-side JS.
       Only use this for local/private testing. DO NOT deploy to public hosting.
       ---------------------------------------- */

    // ---------- CONFIG: YOUR API KEY (unsafe) ----------
    const INSECURE_API_KEY = "vsk-proj-EoVqUgm0o-RF6-Pi-mBKaS3FQsl6ZLc5NjmRfPxws3Ftr13rMNeDA6Vpu69Hhj6PW-f1JnFt5AT3BlbkFJ8Ua3eaGUyTz6TTomyKURemxYLJHEDOF86XxoXyfekmCUFKgucbjfUc_DM4ff0Monq-mWVPrcgA";
    // ---------------------------------------------------

    // Time updater
    function updateTime(){
      document.getElementById("timeBar").textContent = new Date().toLocaleTimeString();
    }
    setInterval(updateTime,1000);
    updateTime();

    // Gmail & Search
    function openGmail(){ window.open("https://mail.google.com/", "_blank"); }
    function searchQuery(){
      const q = encodeURIComponent(document.getElementById("searchBox").value.trim());
      if(q) window.open(`https://duckduckgo.com/?q=${q}`, "_blank");
    }

    // Battery API
    if(navigator.getBattery){
      navigator.getBattery().then(b => {
        function upd(){ document.getElementById("battery").textContent = "üîã "+Math.round(b.level*100)+"%"; }
        upd();
        b.addEventListener("levelchange", upd);
      }).catch(()=>{/*ignore*/});
    }

    // Weather & Reverse Geocode
    async function fetchWeather(lat, lon){
      try{
        const r = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
        const d = await r.json();
        if(d.current_weather && typeof d.current_weather.temperature !== "undefined"){
          document.getElementById("temperature").textContent = `üå°Ô∏è ${d.current_weather.temperature.toFixed(1)}¬∞C`;
        }
      }catch(e){ console.error("weather", e); }
    }
    async function fetchLocation(lat, lon){
      try{
        const r = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`);
        const d = await r.json();
        if(d && d.address){
          const city = d.address.city||d.address.town||d.address.village||"Unknown";
          const state = d.address.state||"";
          document.getElementById("location").textContent = `üìç ${city}${state?(", "+state):""}`;
        }
      }catch(e){ console.error("geocode", e); }
    }
    function initLocation(){
      if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(pos=>{
          const lat = pos.coords.latitude, lon = pos.coords.longitude;
          fetchWeather(lat, lon);
          fetchLocation(lat, lon);
        }, err=>{
          // fallback to NYC
          fetchWeather(40.7128, -74.0060);
          fetchLocation(40.7128, -74.0060);
          document.getElementById("location").textContent = "üìç Location unavailable";
        });
      } else {
        fetchWeather(40.7128, -74.0060);
        fetchLocation(40.7128, -74.0060);
        document.getElementById("location").textContent = "üìç Geolocation unsupported";
      }
    }
    initLocation();

    // Shortcuts (localStorage)
    const shortcutsKey = "omni_shortcuts_v1";
    function loadShortcuts(){
      const arr = JSON.parse(localStorage.getItem(shortcutsKey)||"[]");
      const cont = document.getElementById("shortcuts");
      cont.innerHTML = "";
      arr.forEach(s=>{
        const a = document.createElement("a");
        a.href = s.url; a.target="_blank"; a.className="shortcut";
        a.textContent = s.name;
        cont.appendChild(a);
      });
    }
    function addShortcut(e){
      e.preventDefault();
      const name = document.getElementById("shortcutName").value.trim();
      const url = document.getElementById("shortcutUrl").value.trim();
      if(!name||!url) return false;
      const arr = JSON.parse(localStorage.getItem(shortcutsKey)||"[]");
      arr.push({name,url});
      localStorage.setItem(shortcutsKey, JSON.stringify(arr));
      loadShortcuts();
      e.target.reset();
      return false;
    }
    loadShortcuts();

    // Cloak
    function cloakTab(){
      const title = document.getElementById("cloakTitle").value.trim();
      const icon = document.getElementById("cloakIcon").value.trim();
      if(title) document.title = title;
      if(icon) document.getElementById("favicon").href = icon;
    }

    // Background editor
    function editBackground(){
      const url = prompt("Enter background image URL (leave empty for default):");
      if(url){
        document.body.style.background = `url('${url}') center/cover no-repeat fixed`;
      } else {
        document.body.style.background = "linear-gradient(270deg,#0f172a,#1e293b,#0f172a)";
        document.body.style.backgroundSize = "600% 600%";
      }
    }

    // AI Assistant behaviors (UNSAFE: uses client-side API key)
    document.getElementById("aiToggle").addEventListener("click", ()=>{
      const box = document.getElementById("aiContainer");
      if(box.style.display === "block"){ box.style.display = "none"; box.setAttribute("aria-hidden","true"); }
      else { box.style.display = "block"; box.setAttribute("aria-hidden","false"); document.getElementById("aiInput").focus(); }
    });

    function clearAI(){
      document.getElementById("aiInput").value = "";
      document.getElementById("aiResponse").textContent = "üí¨ Response will appear here...";
    }

    async function askAI(){
      const prompt = document.getElementById("aiInput").value.trim();
      const out = document.getElementById("aiResponse");
      if(!prompt) return;
      out.textContent = "ü§î Thinking...";

      try{
        // Example: call OpenAI chat completions endpoint with your API key embedded (UNSAFE)
        const resp = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + INSECURE_API_KEY
          },
          body: JSON.stringify({
            model: "gpt-4o-mini", // change if desired/available
            messages: [
              { role: "system", content: "You are Omni Assistant ‚Äî helpful, concise." },
              { role: "user", content: prompt }
            ],
            max_tokens: 700,
            temperature: 0.7
          })
        });

        if(!resp.ok){
          const txt = await resp.text();
          console.error("AI error", resp.status, txt);
          out.textContent = "‚ö†Ô∏è AI API error: " + resp.status;
          return;
        }

        const data = await resp.json();
        // Try multiple response shapes
        const content = data.choices?.[0]?.message?.content ?? data.choices?.[0]?.text ?? JSON.stringify(data);
        out.textContent = content.trim();
      }catch(err){
        console.error("askAI error", err);
        out.textContent = "‚ö†Ô∏è Error contacting AI API (see console).";
      }
    }

    // Generate starfield
    (function starfield(){
      const c = document.getElementById("stars");
      for(let i=0;i<80;i++){
        const s = document.createElement("div");
        s.className = "star";
        const size = Math.random()*3 + 1;
        s.style.width = s.style.height = size + "px";
        s.style.top = (Math.random()*100) + "%";
        s.style.left = (Math.random()*100) + "%";
        s.style.animationDelay = (Math.random()*6) + "s";
        c.appendChild(s);
      }
    })();

  </script>
</body>
</html>
